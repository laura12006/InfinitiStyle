openapi: 3.0.3
info:
  title: InfinitiStyle API
  description: API backend de InfinitiStyle — especificación OpenAPI generada automáticamente (resumen).
  version: '1.0.0'
servers:
  - url: http://localhost:5000
    description: Servidor local
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        detail:
          type: string
    TokenResponse:
      type: object
      properties:
        token:
          type: string
    UserShort:
      type: object
      properties:
        id_usuario:
          type: integer
        1_nombre:
          type: string
        1_apellido:
          type: string
        correo_electronico:
          type: string
    RegisterRequest:
      type: object
      required: [correo_electronico, contrasena, 1_nombre, 1_apellido]
      properties:
        correo_electronico:
          type: string
        contrasena:
          type: string
        1_nombre:
          type: string
        2_nombre:
          type: string
        1_apellido:
          type: string
        2_apellido:
          type: string
        talla:
          type: string
        fecha_nacimiento:
          type: string
        foto:
          type: string
    LoginRequest:
      type: object
      required: [correo_electronico, contrasena]
      properties:
        correo_electronico:
          type: string
        contrasena:
          type: string
    PublicationShort:
      type: object
      properties:
        id_publicacion:
          type: integer
        descripcion:
          type: string
        tipo_publicacion:
          type: string
        fecha_publicacion:
          type: string
    TransactionCreate:
      type: object
      required: [publication_id]
      properties:
        publication_id:
          type: integer
        message:
          type: string

paths:
  /uploads/{filename}:
    get:
      summary: Obtener archivo subido
      parameters:
        - name: filename
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Archivo retornado
        '404':
          description: No encontrado

  /api/contact:
    post:
      summary: Enviar mensaje de contacto
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                subject:
                  type: string
                message:
                  type: string
      responses:
        '200':
          description: Mensaje enviado
        '400':
          description: Datos inválidos

  /api/register:
    post:
      summary: Registrar usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Usuario creado
        '400':
          description: Error en datos

  /api/login:
    post:
      summary: Autenticar usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Token JWT
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '401':
          description: Credenciales inválidas

  /api/me:
    get:
      summary: Obtener datos del usuario autenticado
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Datos del usuario
        '401':
          description: No autorizado

  /api/profile:
    put:
      summary: Actualizar perfil (autenticado)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                1_nombre:
                  type: string
                2_nombre:
                  type: string
                1_apellido:
                  type: string
                2_apellido:
                  type: string
                talla:
                  type: string
                fecha_nacimiento:
                  type: string
                foto:
                  type: string
      responses:
        '200':
          description: Perfil actualizado
        '400':
          description: Datos inválidos

  /api/profile/{user_id}:
    get:
      summary: Obtener perfil público de un usuario
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Perfil del usuario
        '404':
          description: No encontrado

  /api/password/change-auth:
    post:
      summary: Cambiar contraseña (autenticado)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                old_password:
                  type: string
                new_password:
                  type: string
      responses:
        '200':
          description: Contraseña cambiada

  /api/verify:
    post:
      summary: Verificar cuenta con código
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                correo_electronico:
                  type: string
                code:
                  type: string
      responses:
        '200':
          description: Cuenta verificada y token devuelto

  /api/password/send-code:
    post:
      summary: Enviar código para cambiar contraseña
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                correo_electronico:
                  type: string
      responses:
        '200':
          description: Código enviado

  /api/password/change:
    post:
      summary: Cambiar contraseña con código
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                correo_electronico:
                  type: string
                code:
                  type: string
                new_password:
                  type: string
      responses:
        '200':
          description: Contraseña cambiada

  /api/publications:
    get:
      summary: Listar publicaciones (filtros disponibles por querystring)
      parameters:
        - name: talla
          in: query
          schema:
            type: string
        - name: estado
          in: query
          schema:
            type: string
        - name: tipo_publicacion
          in: query
          schema:
            type: string
        - name: valor_min
          in: query
          schema:
            type: number
        - name: valor_max
          in: query
          schema:
            type: number
      responses:
        '200':
          description: Lista de publicaciones

    post:
      summary: Crear publicación (multipart/form-data con imagen)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                foto:
                  type: string
                  format: binary
                descripcion:
                  type: string
                tipo_publicacion:
                  type: string
                nombre:
                  type: string
                descripcion_prenda:
                  type: string
                talla:
                  type: string
                valor:
                  type: number
      responses:
        '200':
          description: Publicación creada

  /api/publications/{pub_id}:
    put:
      summary: Actualizar publicación (multipart/form-data)
      security:
        - bearerAuth: []
      parameters:
        - name: pub_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                foto:
                  type: string
                  format: binary
                descripcion:
                  type: string
                tipo_publicacion:
                  type: string
                nombre:
                  type: string
                descripcion_prenda:
                  type: string
                talla:
                  type: string
                valor:
                  type: number
      responses:
        '200':
          description: Publicación actualizada

    delete:
      summary: Eliminar publicación
      security:
        - bearerAuth: []
      parameters:
        - name: pub_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Eliminada

  /api/valoraciones/{user_id}:
    get:
      summary: Obtener valoraciones de un usuario
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Lista de valoraciones

    post:
      summary: Valorar a un usuario (autenticado)
      security:
        - bearerAuth: []
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                puntaje:
                  type: integer
                transaction_id:
                  type: integer
      responses:
        '200':
          description: Valoración registrada

  /api/wishlist:
    get:
      summary: Obtener wishlist del usuario autenticado
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de deseos

  /api/wishlist/{publication_id}:
    post:
      summary: Agregar publicación a wishlist
      security:
        - bearerAuth: []
      parameters:
        - name: publication_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Agregado

    delete:
      summary: Eliminar de wishlist
      security:
        - bearerAuth: []
      parameters:
        - name: publication_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Eliminado

  /api/wishlist/check/{publication_id}:
    get:
      summary: Verificar si está en wishlist
      parameters:
        - name: publication_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Estado de wishlist

  /api/admin/users:
    get:
      summary: Obtener usuarios (admin)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista paginada de usuarios

    post:
      summary: Crear usuario (admin)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '201':
          description: Usuario creado

  /api/admin/users/{user_id}:
    put:
      summary: Actualizar usuario (admin)
      security:
        - bearerAuth: []
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Actualizado

    delete:
      summary: Eliminar usuario (admin)
      security:
        - bearerAuth: []
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Eliminado

  /api/conversations:
    get:
      summary: Obtener conversaciones del usuario autenticado
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de conversaciones

  /api/messages/{other_user_id}:
    get:
      summary: Obtener mensajes con otro usuario
      security:
        - bearerAuth: []
      parameters:
        - name: other_user_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Lista de mensajes

    post:
      summary: Enviar mensaje
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                recipient_id:
                  type: integer
                content:
                  type: string
      responses:
        '201':
          description: Mensaje creado

  /api/transactions:
    get:
      summary: Obtener transacciones del usuario
      security:
        - bearerAuth: []
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [all, buying, selling]
      responses:
        '200':
          description: Lista de transacciones

    post:
      summary: Iniciar transacción
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransactionCreate'
      responses:
        '201':
          description: Transacción iniciada

  /api/transactions/{transaction_id}/payment-proof:
    post:
      summary: Subir comprobante de pago (file)
      security:
        - bearerAuth: []
      parameters:
        - name: transaction_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                proof:
                  type: string
                  format: binary
      responses:
        '200':
          description: Comprobante subido

  /api/transactions/{transaction_id}/confirm-payment:
    put:
      summary: Confirmar pago recibido (vendedor)
      security:
        - bearerAuth: []
      parameters:
        - name: transaction_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Pago confirmado

  /api/transactions/{transaction_id}/ship:
    put:
      summary: Marcar como enviado (vendedor)
      security:
        - bearerAuth: []
      parameters:
        - name: transaction_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                tracking_info:
                  type: string
      responses:
        '200':
          description: Estado actualizado

  /api/transactions/{transaction_id}/delivered:
    put:
      summary: Confirmar entrega (comprador)
      security:
        - bearerAuth: []
      parameters:
        - name: transaction_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Entrega confirmada

  /api/transactions/{transaction_id}:
    get:
      summary: Obtener detalles de una transacción
      security:
        - bearerAuth: []
      parameters:
        - name: transaction_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Detalles de transacción

externalDocs:
  description: README backend
  url: ./README.md
